%-------------------------------------------------------------------------------
\subsection{Writeback}
%-------------------------------------------------------------------------------

Validation occurs on every Shard that a transaction spans. The goal of the Writeback phase is to aggregate all relevant shard-decisions and to inform replicas of finalized Commit or Abort decisions. This is necessary in order for replicas to be able to garbage collect meta-data of ongoing transactions, and to allow consecutive transactions to reliably observe the updated state. Any finalized decision must respect all shard-decisions relevant to a transaction. Thus, all decisions are aggregated according to standard two-phase commit. \sys follows a simple 2PC protocol: Only if all shards agree that a transaction may commit (i.e. there exist commit certificates for every shard), then a transaction may commit. A single abort shart-decision suffices to abort a transaction respectively.

\textbf{1.} A coordinator waits for all necessary shard decisions, including certificates\\
\textbf{2.} The coordinator broadcasts a $Writeback \coloneqq (TX, decision, \{certificates_S \} )$ message to all replicas in all relevant shards.\\
\textbf{3.} A replica validates whether the certificates match the decision, and commits/aborts the transaction by applying the relevant store updates, resuming potentially suspended MVTSO-Checks, and garbage collecting all ongoing transaction state. Replicas store the Writeback message which is used as Commit proof to service reads and justify conflicts, or Abort proof to justify dependency aborts.

We point out, that the Writeback coordinator need not be the client issuing the transaction, but can in fact be an arbitrary party (client or replica) that is interested in completing the Writeback. This follows straightforwardly from Theorem Y: Any certified shard-decision implies the existence of a logged decision, and hence the Writeback phase is idempotent.
We utilize this to drive the recovery protocol outlined next. 

